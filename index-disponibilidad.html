<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Widget de Disponibilidad</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body{font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif}
    .dragging{user-select:none}
  </style>
</head>
<body class="bg-transparent">
  <!-- CONTENEDOR FLOTANTE -->
  <div id="widget"
       class="fixed right-4 bottom-4 z-[99999] w-[320px] rounded-2xl shadow-lg bg-white border border-gray-100">
    <!-- Header (zona arrastrable) -->
    <div id="header"
         class="cursor-grab active:cursor-grabbing flex items-center justify-between px-3 py-2 border-b border-gray-100 bg-black/90 text-white rounded-t-2xl">
      <div class="flex items-center gap-2">
        <div class="h-5 w-5 rounded-lg bg-white/20"></div>
        <h1 class="text-sm font-semibold">Disponibilidad</h1>
      </div>
      <div class="flex items-center gap-1">
        <button id="minBtn"
          class="text-[11px] px-2 py-1 rounded-md bg-white/10 hover:bg-white/20">Min</button>
        <button id="resetBtn"
          class="text-[11px] px-2 py-1 rounded-md bg-white/10 hover:bg-white/20">Reiniciar</button>
      </div>
    </div>

    <!-- Contenido -->
    <div id="content">
      <ul id="list" class="px-2 pb-2"></ul>
      <div class="px-4 pb-4 grid grid-cols-2 gap-2 text-[11px] text-gray-600">
        <div class="flex items-center gap-2"><span class="h-2.5 w-2.5 rounded-full bg-red-500"></span>No molestar</div>
        <div class="flex items-center gap-2"><span class="h-2.5 w-2.5 rounded-full bg-yellow-400"></span>Ocupado/a</div>
        <div class="flex items-center gap-2"><span class="h-2.5 w-2.5 rounded-full bg-green-500"></span>Disponible</div>
        <div class="flex items-center gap-2"><span class="h-2.5 w-2.5 rounded-full bg-gray-400"></span>No trabaja</div>
      </div>
    </div>
  </div>

  <script>
    // Datos
    const NAMES = ["Francesca","Miguel","Ana","Ricard","Santi"];
    const ORDER = ["gray","green","yellow","red"];
    const META = {
      gray:{ label:"No trabaja", class:"bg-gray-400" },
      green:{ label:"Disponible", class:"bg-green-500" },
      yellow:{ label:"Ocupado/a", class:"bg-yellow-400" },
      red:{ label:"No molestar", class:"bg-red-500" },
    };
    const STATUS_KEY = "availability-widget-v1";
    const POS_KEY = "availability-widget-position";

    let statuses = JSON.parse(localStorage.getItem(STATUS_KEY) || "{}");

    function cycle(name){
      const cur = statuses[name] || ORDER[0];
      const next = ORDER[(ORDER.indexOf(cur)+1)%ORDER.length];
      statuses[name] = next;
      localStorage.setItem(STATUS_KEY, JSON.stringify(statuses));
      render();
    }
    function resetAll(){
      statuses = {};
      localStorage.setItem(STATUS_KEY, JSON.stringify(statuses));
      render();
    }

    function render(){
      const list = document.getElementById("list");
      list.innerHTML = NAMES.map(name=>{
        const st = statuses[name] || "gray";
        const m = META[st];
        return `
          <li class="flex items-center justify-between px-3 py-2 rounded-xl hover:bg-gray-50 transition">
            <div class="flex items-center gap-3">
              <div class="flex h-9 w-9 items-center justify-center rounded-xl bg-gray-100 text-sm font-medium">${name[0]}</div>
              <div>
                <p class="text-sm font-medium">${name}</p>
                <p class="text-xs text-gray-500">${m.label}</p>
              </div>
            </div>
            <button onclick="cycle('${name}')" class="h-6 w-6 rounded-full ${m.class} ring-2 ring-black/5 hover:ring-black/10 transition"></button>
          </li>
        `;
      }).join("");
    }
    render();

    // Controles
    document.getElementById("resetBtn").onclick = resetAll;

    // Minimizar / expandir
    let minimized = false;
    const content = document.getElementById("content");
    const minBtn = document.getElementById("minBtn");
    minBtn.onclick = ()=>{
      minimized = !minimized;
      if(minimized){
        content.style.display = "none";
        minBtn.textContent = "Max";
        document.getElementById("widget").style.width = "240px";
      }else{
        content.style.display = "";
        minBtn.textContent = "Min";
        document.getElementById("widget").style.width = "320px";
      }
    };

    // Arrastrable con guardado de posición
    (function makeDraggable(){
      const widget = document.getElementById("widget");
      const header = document.getElementById("header");

      // Restaurar posición guardada si existe
      const saved = JSON.parse(localStorage.getItem(POS_KEY) || "null");
      if(saved){
        widget.style.left = saved.left+"px";
        widget.style.top = saved.top+"px";
        widget.style.right = "auto";
        widget.style.bottom = "auto";
      }

      let isDown=false, startX=0, startY=0, startLeft=0, startTop=0;

      const start = (x,y)=>{
        isDown = true;
        document.body.classList.add("dragging");
        const rect = widget.getBoundingClientRect();
        startLeft = rect.left;
        startTop = rect.top;
        startX = x; startY = y;
        widget.style.left = `${startLeft}px`;
        widget.style.top = `${startTop}px`;
        widget.style.right = "auto";
        widget.style.bottom = "auto";
      };
      const move = (x,y)=>{
        if(!isDown) return;
        const nx = startLeft + (x - startX);
        const ny = startTop + (y - startY);
        widget.style.left = Math.max(8, Math.min(nx, window.innerWidth - widget.offsetWidth - 8)) + "px";
        widget.style.top  = Math.max(8, Math.min(ny, window.innerHeight - widget.offsetHeight - 8)) + "px";
      };
      const end = ()=>{
        if(isDown){
          // Guardar posición
          localStorage.setItem(POS_KEY, JSON.stringify({
            left: parseInt(widget.style.left),
            top: parseInt(widget.style.top)
          }));
        }
        isDown=false;
        document.body.classList.remove("dragging");
      };

      // Mouse
      header.addEventListener("mousedown",(e)=>start(e.clientX,e.clientY));
      window.addEventListener("mousemove",(e)=>move(e.clientX,e.clientY));
      window.addEventListener("mouseup",end);
      // Touch
      header.addEventListener("touchstart",(e)=>{
        const t=e.touches[0]; start(t.clientX,t.clientY);
      },{passive:true});
      window.addEventListener("touchmove",(e)=>{
        const t=e.touches[0]; move(t.clientX,t.clientY);
      },{passive:false});
      window.addEventListener("touchend",end);
    })();
  </script>
</body>
</html>
